@model IEnumerable<MVC_CRUD.Models.contactCenterModels.Performance>
@{
    ViewBag.submenu = "Report";
}
<!-- Include Page Header -->
@RenderPage("~/Views/Gates/Head.cshtml")
@*<script src="~/Scripts/jquery-1.7.1.js"></script>*@
<script>
    function add2() {

            var Custdata = new FormData();
            var CustProId = $("#CustProId").val();
            Custdata.append("CustProId", CustProId);
            var DateFrom = $("#DateFrom").val();
            Custdata.append("DateFrom", DateFrom);
            var DateTo = $("#DateTo").val();
            Custdata.append("DateTo", DateTo);

            $("#byPerformance").find('tbody tr').remove();
            $("#byProductivity").find('tbody tr').remove();

        $.ajax({
            url: '@Url.Action("targetSet2", "Home")',
            type: 'POST',
            data: Custdata,
            contentType: false,
            processData: false,
            async: true,
            success: function (data) {
                if (data.Performance) {
                    data.Performance.forEach(function (item) {
                        $('#byPerformance').find('tbody').append('<tr><td>' + item.UserName + '</td><td><image src="' + item.Image + '"/>&nbsp;' + item.Achievment + ' %</td><td>' + item.Target + '</td><td>' + item.Closing + '</td><td>' + item.Prospect + '</td><td>' + item.Contacted + '</td><td>' + item.Connected + '</td><td>' + item.NotConnected + '</td></tr>')
                    });
                }
                if (data.Productivity) {
                    data.Productivity.forEach(function (item) {
                        $('#byProductivity').find('tbody').append('<tr><td>' + item.UserName + '</td><td>' + item.callAtemp + '</td><td>' + item.Utillization + '</td><td>' + item.talkTime + '</td></tr>')
                    });
                }
            },
            error: function (error) {
                alert('error');
            }
        });
    }
</script>

<body class="sb-left">
    @RenderPage("~/Views/Gates/Header.cshtml")
    <!-- APP MAIN ==========-->
    <main id="app-main" class="app-main">
        <div class="wrap">
            <section class="app-content">

                <div class="row">
                    <!-- DOM dataTable -->
                    
                    <div class="col-sm-12">

                        <div class="col-sm-3">
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <select id="CustProId" name="CustomerId" class="selectpicker show-menu-arrow show-tick selectstyle createSelect" title="Select Project" data-style="btn-info">
                                        <optgroup label="Project Name">
                                            @foreach (var item in ViewBag.CustProId)
                                            {
                                                <option value="@item.CustProId">@item.CustProName</option>
                                            }
                                        </optgroup>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-3">
                            <div class="form-group">
                                <div class="col-sm-2">
                                    <label class="control-label" for="from">From</label>
                                </div>
                                <div class="col-sm-10">
                                    <div class="input-group date" id="from" data-date-format="dd-M-yyyy" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                                        <input type="text" id="DateFrom" name="DateFrom" class="form-control" required onchange="CheckDate()" />
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                        <input type="hidden" id="dtp_input2" value="" />
                                    </div>
                                    <div id="ManagerError"></div>
                                </div>
                            </div>
                        </div>
                     
                        <div class="col-sm-3">
                            <div class="form-group">
                                <div class="col-sm-2">
                                    <label class="control-label" for="to">To</label>
                                </div>
                                <div class="col-sm-10">
                                    <div class="input-group date" id="to" data-date="" data-date-format="dd-M-yyyy" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                                        <input type="text" id="DateTo" name="DateTo" class="form-control" required onchange="CheckDate()" />
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                        <input type="hidden" id="dtp_input2" value="" />
                                    </div>
                                    <div id="ManagerError"></div>
                                </div>
                            </div>
                        </div>
                      

                        <div class="col-sm-3">
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <button type="button" class="btn btn-info btn-raised btn-sm submit" onclick="add2()"><i class="fa fa-paw"></i> &nbsp; Search</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="separator" />

                    <div class="widget">
                        <div class="widget-header">
                            <ul class="nav nav-tabs">
                                <li class="active"><a data-toggle="tab" href="#byPerformance">Report by Performance</a></li>
                                <li><a data-toggle="tab" href="#byProductivity">Report by Productivity</a></li>
                            </ul>
                        </div>
                        <div class="tab-content">
                            <div id="byPerformance" class="tab-pane fade in active">
                                <div class="widget-body">
                                    <div class="table-responsive">
                                        <table id="default-datatable" data-plugin="DataTable" class="table table-striped" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>Agent Name</th>
                                                    <th>Achievement</th>
                                                    <th>Target</th>
                                                    <th>Closing</th>
                                                    <th>Prospect</th>
                                                    <th>Contacted</th>
                                                    <th>Connected</th>
                                                    <th>Not Connected</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div><!-- .widget-body -->
                            </div>

                            <div id="byProductivity" class="tab-pane fade in">
                                <div class="widget-body">
                                    <div class="table-responsive">
                                        <table id="default-datatable" data-plugin="DataTable" class="table table-striped" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>User</th>
                                                    <th>Call Attempt</th>
                                                    <th>Utillization</th>
                                                    <th>Talk Time</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div><!-- .widget-body -->
                            </div>
                        </div>

                    </div><!-- .widget -->
                </div><!-- END column -->
                <!-- Ajax dataTable -->
        </div><!-- .row -->
        </section><!-- .app-content -->
        </div><!-- .wrap -->
        <!-- Include Page Footer -->
        @RenderPage("~/Views/Gates/Footer.cshtml")
        <!-- Include Page Foot -->
        @RenderPage("~/Views/Gates/Foot.cshtml")

    </main>
    <!--========== END app main -->
</body>

<script type="text/javascript">
            
            function CheckDate() {
                if ($("#txtstart").val() != "" && $("#txtend").val() != "") {

                    var from = new Date($("#DateFrom").val());
                    var to = new Date($("#DateTo").val());

                    var diffDays = parseInt((to - from) / (1000 * 60 * 60 * 24));

                    if (diffDays > 30 || diffDays < 0) {
                        DateFrom.value = "";
                        DateTo.value = "";
                    }
                }
            }
</script>